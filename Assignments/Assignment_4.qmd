---
title: "Assignment_4"
format: html
editor: visual
warning: true
message: true
echo: true
toc: true
---

```{r}
rm (list = ls())
library(tidyverse)
library(lubridate)
library(quantmod)
library(janitor)

```

# Task 1

You will find the data for these tasks at the following url:

[**https://raw.githubusercontent.com/uit-sok-1005-v23/uit-sok-1005-v23.github.io/main/storedata.csv**](https://raw.githubusercontent.com/uit-sok-1005-v23/uit-sok-1005-v23.github.io/main/storedata.csv).

The data file contains 7185 observations and 9 variables.

1: For the last 3 months of 2017, calculate the total Sales by month, for Region 1 and Region 9 in the Customer_Segment, Corporate, and Consumer. This output is Table 1.

2: Make a plot of the monthly total Sales in Region 1 and Region 13 in 2015, 2016, and 2017. This output is Figure 1.

3: In Figure 1, identify the months where the total Sales in Region 13 is greater than the total Sales in Region 1. This output is Table 2.

4: Find the average Profit per Customer_Segment and Product_Category in 2017, for all regions except Region 3, 5 and 8. What segment produced the highest average profit? This output is Table 3.

```{r}

storedata <- read.csv("https://raw.githubusercontent.com/uit-sok-1005-v23/uit-sok-1005-v23.github.io/main/storedata.csv")


```

# Task 2

```{r}

xom <- read.csv("https://query1.finance.yahoo.com/v7/finance/download/XOM?period1=1262563200&period2=1672444800&interval=1d&events=history&includeAdjustedClose=true")
xom <- xom %>% 
  as_tibble() %>% 
  clean_names() %>% 
  select(date, adj_close, volume) %>% 
  mutate(date = as.Date(date)) %>% 
  mutate(year = year(date), 
         month = month(date), 
         day = day(date)) %>% 
  group_by(year,month) %>% 
  summarise(exxon = weighted.mean(adj_close, volume)) %>% 
  mutate(date = make_date(year,month)) %>% 
  ungroup() %>% 
  select(date, exxon)


fredoil <- data.frame(getSymbols("DCOILBRENTEU", src = "FRED", auto.assign = FALSE))

fredoil <- fredoil %>% 
  mutate(date = ymd(rownames(fredoil))) %>% 
  rename(price = 1) %>% 
  select(date, price) %>% 
  filter(date >="2010-01-04",date<"2022-12-31") 

fredoil <- fredoil %>% 
  mutate(year = year(date), 
         month = month(date), 
         day = day(date)) %>% 
  group_by(year,month) %>% 
  summarise(oil= mean(price, na.rm=TRUE)) %>% 
  mutate(date = make_date(year,month)) %>% 
  as_tibble() %>% 
  ungroup() %>% 
  select(date, oil)


task2 <- xom %>% 
  cbind(oil = fredoil$oil)

rm(fredoil)
rm(xom)
```

```{r}
task2 %>% 
  ggplot(aes(x=date)) + 
  geom_line(aes(y=oil)) +
  geom_line(aes(y=exxon))
```
